# Motion Dino -- ä½“æ„Ÿæé¾™è·‘é…·æ¸¸æˆ

## å¼€å‘è®¾è®¡æ–‡æ¡£ v1.1

> ç›®æ ‡ç”¨æˆ·: 2-4 å²å¹¼å„¿ï¼ˆæ ¸å¿ƒ: 3 å²ï¼‰ | å¹³å°: macOS (M3 Max) Chrome æµè§ˆå™¨ | æ¡†æ¶: Next.js 15

---

## ä¸€ã€äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½

ä¸€æ¬¾é¢å‘ 2-4 å²å¹¼å„¿ï¼ˆé‡ç‚¹é€‚é… 3 å²ï¼‰çš„**ä½“æ„Ÿæ§åˆ¶**ç½‘é¡µå°æ¸¸æˆã€‚å­©å­ç«™åœ¨æ‘„åƒå¤´å‰ï¼Œé€šè¿‡**è·³è·ƒ**å’Œ**è¹²ä¸‹**çš„èº«ä½“åŠ¨ä½œæ§åˆ¶å±å¹•ä¸Šçš„å°æé¾™èº²é¿éšœç¢ç‰©ã€‚

æ ¸å¿ƒä½“éªŒ: è®©å­©å­åœ¨ç©è€ä¸­è‡ªç„¶åœ°è¿åŠ¨èº«ä½“ï¼Œè·å¾—å³æ—¶çš„è§†è§‰åé¦ˆå’Œæˆå°±æ„Ÿã€‚

### 1.2 æ ¸å¿ƒç©æ³•

| èº«ä½“åŠ¨ä½œ | æ¸¸æˆæ•ˆæœ | è¯´æ˜ |
|---------|---------|------|
| è·³èµ·æ¥ | æé¾™è·³è·ƒ | èº²é¿åœ°é¢ä»™äººæŒ |
| è¹²ä¸‹å» | æé¾™ä½å¤´ | èº²é¿ç©ºä¸­ç¿¼é¾™ |
| ç«™ç€ä¸åŠ¨ | æé¾™å¥”è·‘ | é»˜è®¤çŠ¶æ€ |

### 1.3 è®¾è®¡åŸåˆ™

1. **é›¶é—¨æ§›**: ä¸éœ€è¦ä»»ä½•æŒ‰é”®æ“ä½œï¼Œæ‰“å¼€å³ç©
2. **é«˜å®¹é”™**: æ£€æµ‹é˜ˆå€¼å®½æ¾ï¼Œç¢°æ’åˆ¤å®šå‹å¥½ï¼Œé¼“åŠ±è€Œéæƒ©ç½š
3. **ä½æŒ«è´¥**: ç¢°æ’åè‡ªåŠ¨é‡å¼€ï¼Œæ²¡æœ‰ Game Over æ–‡å­—ï¼Œç”¨é¼“åŠ±åŠ¨ç”»æ›¿ä»£
4. **çŸ­ä¼šè¯**: å•å±€ 2-5 åˆ†é’Ÿï¼ŒåŒ¹é…å¹¼å„¿æ³¨æ„åŠ›å‘¨æœŸ
5. **äº²å­å‹å¥½**: å®¶é•¿å¯ä»¥åœ¨æ—è¾¹ä¸€èµ·ç©ï¼Œç•Œé¢ä¿¡æ¯å¯¹å®¶é•¿ä¹Ÿæœ‰ä»·å€¼

---

## äºŒã€UI/UX è®¾è®¡

### 2.1 æ•´ä½“å¸ƒå±€

```
+----------------------------------------------------------+
|  [åˆ†æ•°: å¤§å­—ä½“]                    [æ£€æµ‹çŠ¶æ€æŒ‡ç¤ºç¯]        |
|                                                          |
|                                                          |
|              Canvas æ¸¸æˆä¸»ç”»é¢ (å…¨å±å®½åº¦)                  |
|                                                          |
|      ğŸŒµ       ğŸ¦•                          ğŸŒµğŸŒµ            |
|  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•åœ°é¢çº¿â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  |
|                                                          |
+----------------------------------------------------------+
|                                          +----------+    |
|          åŠ¨ä½œåé¦ˆåŒºåŸŸ                      | æ‘„åƒå¤´   |    |
|     (è·³è·ƒ/è¹²ä¸‹æ—¶çš„å¤§å›¾æ ‡åŠ¨ç”»)              | é•œåƒé¢„è§ˆ |    |
|                                          +----------+    |
+----------------------------------------------------------+
```

å¸ƒå±€åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡:
- **é¡¶éƒ¨ä¿¡æ¯æ **: åˆ†æ•°(å·¦)ã€æ£€æµ‹çŠ¶æ€(å³)
- **ä¸­é—´æ¸¸æˆåŒº**: Canvas ä¸»ç”»é¢ï¼Œå æ®è§†å£ä¸»ä½“
- **åº•éƒ¨è¾…åŠ©åŒº**: å·¦ä¾§ä¸ºåŠ¨ä½œåé¦ˆåŒºï¼Œå³ä¸‹è§’ä¸ºæ‘„åƒå¤´å°çª—

### 2.2 é¢œè‰²æ–¹æ¡ˆ

é‡‡ç”¨æ˜äº®ã€é«˜é¥±å’Œåº¦çš„æš–è‰²è°ƒï¼Œç¬¦åˆå¹¼å„¿è§†è§‰åå¥½:

| ç”¨é€” | é¢œè‰² | è‰²å€¼ |
|-----|------|------|
| å¤©ç©ºèƒŒæ™¯ | æŸ”å’Œå¤©è“ | `#87CEEB` |
| åœ°é¢ | æ¸©æš–æ²™é»„ | `#F4D03F` |
| æé¾™ä¸»ä½“ | é²œè‰³ç»¿è‰² | `#2ECC71` |
| æé¾™è‚šçš® | æµ…é»„è‰² | `#F9E79F` |
| ä»™äººæŒ | æ·±ç»¿è‰² | `#27AE60` |
| ç¿¼é¾™ | ç´«çº¢è‰² | `#8E44AD` |
| åˆ†æ•°æ–‡å­— | æ©™è‰² | `#E67E22` |
| äº‘æœµ | ç™½è‰² | `#FFFFFF` |
| åé¦ˆ-è·³è·ƒ | äº®é»„è‰² | `#F1C40F` |
| åé¦ˆ-è¹²ä¸‹ | äº®è“è‰² | `#3498DB` |

ä¸åŸç‰ˆ Chrome Dino çš„ç°è‰²åƒç´ é£ä¸åŒï¼Œæœ¬æ¸¸æˆé‡‡ç”¨**å½©è‰²å¡é€šé£æ ¼**ï¼ŒèƒŒæ™¯æœ‰è“å¤©ç™½äº‘å’Œè¿œå¤„çš„å°å±±ä¸˜ï¼Œè¥é€ æˆ·å¤–å¥”è·‘çš„æ¬¢å¿«æ°›å›´ã€‚

### 2.3 æé¾™è§’è‰²è®¾è®¡

**é£æ ¼**: åœ†æ¶¦å¯çˆ±çš„å¡é€šæé¾™ï¼Œå¤§çœ¼ç›ï¼ŒçŸ­å°çš„å‰è‚¢ï¼Œç²—å£®çš„åè…¿ï¼Œå°å°¾å·´ç¿˜èµ·

**åŠ¨ç”»çŠ¶æ€**:
| çŠ¶æ€ | åŠ¨ç”» | å¸§æ•° |
|-----|------|------|
| å¥”è·‘ | ä¸¤è…¿äº¤æ›¿è¿ˆæ­¥ï¼Œå°¾å·´å¾®å¾®æ™ƒåŠ¨ | 4 å¸§å¾ªç¯ |
| è·³è·ƒ | åŒè„šç¦»åœ°ï¼Œå‰è‚¢å¼ å¼€ï¼Œè¡¨æƒ…æƒŠå–œ | 2 å¸§(ä¸Šå‡+ä¸‹è½) |
| è¹²ä¸‹ | èº«ä½“å‹ä½ï¼Œå¤´ç¼©è¿›ï¼Œå˜æˆæ¤­åœ†å½¢ | 2 å¸§ |
| ç¢°æ’ | çœ¼ç›å˜æˆæ—‹è½¬åœˆåœˆï¼Œèº«ä½“åä»° | 3 å¸§ |
| å¾…æœº | çœ¨çœ¼ï¼Œå¾®å¾®å·¦å³æ‘‡æ™ƒ | 4 å¸§å¾ªç¯ |

æ‰€æœ‰æé¾™åŠ¨ç”»ä½¿ç”¨ Canvas 2D ç»˜åˆ¶å‡½æ•°å®ç°ï¼ˆçŸ¢é‡ç»˜åˆ¶ï¼‰ï¼Œä¸ä¾èµ–å¤–éƒ¨å›¾ç‰‡èµ„æºï¼Œä¾¿äºè°ƒæ•´é¢œè‰²å’Œå°ºå¯¸ã€‚

### 2.4 éšœç¢ç‰©è®¾è®¡

**ä»™äººæŒ**: åœ†æ¶¦çš„ä»™äººæŒé€ å‹ï¼Œå¸¦å°èŠ±ï¼Œçœ‹èµ·æ¥å¯çˆ±è€Œéå±é™©
- å°ä»™äººæŒ: 40x60 px
- å¤§ä»™äººæŒ: 50x80 px
- ä¸å‡ºç°å¯†é›†çš„ä»™äººæŒç¾¤(æœ€å¤š 2 ä¸ª)

**ç¿¼é¾™**: å¯çˆ±çš„å°ç¿¼é¾™ï¼Œæ‹ç€ç¿…è†€é£è¿‡
- å°ºå¯¸: 60x45 px
- ä¸¤å¸§ç¿…è†€æ‹æ‰“åŠ¨ç”»
- åªåœ¨åˆ†æ•°è¾¾åˆ° 200 åæ‰å‡ºç°(ç»™å­©å­è¶³å¤Ÿçš„é€‚åº”æ—¶é—´)

### 2.5 äº¤äº’åé¦ˆè®¾è®¡

**åŠ¨ä½œåé¦ˆ**(å…³é”®è®¾è®¡ç‚¹):
- æ£€æµ‹åˆ°è·³è·ƒæ—¶: å±å¹•å·¦ä¸‹æ–¹å¼¹å‡ºä¸€ä¸ªå¤§çš„å‘ä¸Šç®­å¤´å›¾æ ‡(äº®é»„è‰²)ï¼Œé…åˆå¼¹æ€§åŠ¨ç”»
- æ£€æµ‹åˆ°è¹²ä¸‹æ—¶: å±å¹•å·¦ä¸‹æ–¹å¼¹å‡ºä¸€ä¸ªå¤§çš„å‘ä¸‹ç®­å¤´å›¾æ ‡(äº®è“è‰²)ï¼Œé…åˆå¼¹æ€§åŠ¨ç”»
- è¿™äº›åé¦ˆå¸®åŠ©å­©å­å»ºç«‹"æˆ‘çš„åŠ¨ä½œ -> å±å¹•å˜åŒ–"çš„å› æœè®¤çŸ¥

**ç¢°æ’åé¦ˆ**:
- ä¸æ˜¾ç¤º "Game Over" æ–‡å­—(3 å²å­©å­ä¸è¯†å­—)
- æé¾™åšä¸€ä¸ªæ»‘ç¨½çš„æ‘”å€’åŠ¨ç”»
- å±å¹•çŸ­æš‚é—ªçƒæ˜Ÿæ˜Ÿç‰¹æ•ˆ
- 2.5 ç§’åè‡ªåŠ¨é‡æ–°å¼€å§‹ï¼Œæé¾™ä»å±å¹•å·¦ä¾§è·‘å…¥
- å¯é€‰: æ’­æ”¾ä¸€ä¸ªä¿çš®çš„ "å“å‘€" éŸ³æ•ˆ

**é‡Œç¨‹ç¢‘åº†ç¥**:
- æ¯ 100 åˆ†: å±å¹•ä¸Šæ–¹é£˜è½æ˜Ÿæ˜Ÿ/å½©å¸¦ï¼ŒæŒç»­ 1.5 ç§’
- é…åˆä¸€ä¸ªæ¬¢å¿«çš„å®å’šéŸ³æ•ˆ
- åˆ†æ•°æ•°å­—æ”¾å¤§å¼¹è·³åŠ¨ç”»

### 2.6 å¼•å¯¼é¡µé¢

é¦–æ¬¡è¿›å…¥æ—¶æ˜¾ç¤ºç®€æ´çš„å›¾ç¤ºå¼•å¯¼:

```
+--------------------------------------------------+
|                                                  |
|           æ¬¢è¿æ¥åˆ°æé¾™ä¹å›­!                        |
|                                                  |
|    [å°äººè·³è·ƒå›¾ç¤º]  -->  [æé¾™è·³è·ƒå›¾ç¤º]              |
|    "è·³ä¸€è·³"              æé¾™è·³èµ·æ¥!               |
|                                                  |
|    [å°äººè¹²ä¸‹å›¾ç¤º]  -->  [æé¾™è¹²ä¸‹å›¾ç¤º]              |
|    "è¹²ä¸€è¹²"              æé¾™ä½å¤´!                  |
|                                                  |
|           (å¤§æŒ‰é’®) [ å¼€å§‹ç©! ]                     |
|                                                  |
|    * é¦–æ¬¡ä½¿ç”¨éœ€è¦å…è®¸æ‘„åƒå¤´æƒé™                     |
|                                                  |
+--------------------------------------------------+
```

- å›¾ç¤ºç”¨ç®€å•å¡é€šé£æ ¼ï¼Œé…åˆåŠ¨ç”»æ¼”ç¤º
- "å¼€å§‹ç©!" æŒ‰é’®å°ºå¯¸ >= 120x60 pxï¼Œåœ†è§’ï¼Œå¸¦è„‰å†²åŠ¨ç”»å¸å¼•ç‚¹å‡»
- å®¶é•¿ä¹Ÿå¯ä»¥é€šè¿‡é”®ç›˜ Space/Up/Down æ“ä½œï¼ˆä½œä¸ºå¤‡é€‰è¾“å…¥æ–¹å¼ï¼‰

### 2.7 æ‘„åƒå¤´é¢„è§ˆçª—å£

- ä½ç½®: å³ä¸‹è§’ï¼Œåœ†è§’çŸ©å½¢
- å°ºå¯¸: 240x180 pxï¼ˆå¯æ‹–åŠ¨è°ƒæ•´ï¼‰
- **é•œåƒæ˜¾ç¤º**: æ°´å¹³ç¿»è½¬ï¼Œè®©å­©å­çœ‹åˆ°çš„è‡ªå·±å’ŒçœŸå®åŠ¨ä½œæ–¹å‘ä¸€è‡´
- åŠé€æ˜è¾¹æ¡†(ç™½è‰², 60% é€æ˜åº¦)
- å¯é€‰: åœ¨äººä½“ä¸Šå åŠ éª¨éª¼çº¿(å½©è‰²)ï¼Œå¢åŠ è¶£å‘³æ€§
- æ£€æµ‹çŠ¶æ€: è¾¹æ¡†é¢œè‰²æŒ‡ç¤º
  - ç»¿è‰²: æ­£å¸¸æ£€æµ‹åˆ°äººä½“
  - é»„è‰²: äººä½“éƒ¨åˆ†è¶…å‡ºç”»é¢
  - çº¢è‰²: æœªæ£€æµ‹åˆ°äººä½“

### 2.8 å“åº”å¼è®¾è®¡

ç›®æ ‡è¿è¡Œç¯å¢ƒä¸º MacBook Pro å…¨å±æµè§ˆå™¨ï¼Œä½†éœ€é€‚é…:
- çª—å£å°ºå¯¸: æœ€å° 1024x768ï¼Œæ¨è 1440x900+
- Canvas æ¸¸æˆç”»é¢è‡ªé€‚åº”å®¹å™¨å®½åº¦
- åœ°é¢çº¿å›ºå®šåœ¨ Canvas åº•éƒ¨ 20% ä½ç½®
- æé¾™å¤§å°ç›¸å¯¹äº Canvas é«˜åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾

---

## ä¸‰ã€æŠ€æœ¯æ¶æ„

### 3.1 æŠ€æœ¯æ ˆ

å‰ç½®ç¯å¢ƒå»ºè®®:
- Node.js 20 LTS æˆ– 22 LTS
- npm 10+

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | è¯´æ˜ |
|-----|---------|------|------|
| æ¡†æ¶ | Next.js | 15.x (App Router) | å…¨æ ˆ React æ¡†æ¶ |
| è¯­è¨€ | TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| å§¿æ€æ£€æµ‹ | @mediapipe/tasks-vision | 0.10.x | Google å®˜æ–¹å§¿æ€æ£€æµ‹ |
| UI ç»„ä»¶ | shadcn/ui | latest | åŸºäº Radix çš„ç»„ä»¶åº“ |
| åŠ¨ç”» | Framer Motion | 11.x | React åŠ¨ç”»åº“ |
| æ ·å¼ | Tailwind CSS | 4.x | åŸå­åŒ– CSS |
| æ¸¸æˆæ¸²æŸ“ | HTML5 Canvas 2D | - | åŸç”Ÿ Canvas API |
| éŸ³é¢‘ | Web Audio API | - | åŸç”ŸéŸ³é¢‘ API |

### 3.2 ç³»ç»Ÿæ¶æ„å›¾

```
                        +-----------------------+
                        |    Next.js App Shell   |
                        |   (App Router, SSR)    |
                        +-----------+-----------+
                                    |
                        +-----------v-----------+
                        |   Page Component      |
                        |   (Client Component)  |
                        +---+-------+-------+---+
                            |       |       |
                +-----------v-+  +--v---+  +v-----------+
                | PoseDetector |  | Game |  | UI Layer   |
                | Module       |  | Engine|  | (shadcn +  |
                |              |  |       |  |  motion)   |
                +-----------+--+  +--+---+  +--+--------+
                            |        |         |
                    +-------v--------v---------v-------+
                    |        Shared State (useRef)      |
                    |  gesture: IDLE | JUMP | DUCK      |
                    |  score, gameState, etc.           |
                    +-----------------------------------+

    æ•°æ®æµ:
    Camera Stream --> MediaPipe PoseLandmarker --> Gesture Engine
                                                      |
                                                      v
                                              Game Engine (Canvas)
                                                      |
                                                      v
                                              UI Updates (React)
```

### 3.3 æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 3.3.1 å§¿æ€æ£€æµ‹æ¨¡å— (`lib/pose-detector.ts`)

**èŒè´£**: å°è£… MediaPipe Pose Landmarkerï¼Œæä¾›ç®€æ´çš„å§¿æ€æ•°æ®æ¥å£

```typescript
// æ ¸å¿ƒæ¥å£å®šä¹‰
interface PoseDetectorConfig {
  modelComplexity: 'lite' | 'full' | 'heavy'; // lite å³å¯æ»¡è¶³éœ€æ±‚
  minDetectionConfidence: number;  // å»ºè®® 0.5
  minTrackingConfidence: number;   // å»ºè®® 0.5
  delegate: 'GPU' | 'CPU';        // M3 Max ä½¿ç”¨ GPU
}

interface PoseResult {
  landmarks: NormalizedLandmark[];  // 33 ä¸ªå…³é”®ç‚¹, xy å½’ä¸€åŒ–åˆ° 0-1
  worldLandmarks: Landmark[];       // 3D ä¸–ç•Œåæ ‡
  timestamp: number;
}

type PoseCallback = (result: PoseResult | null) => void;
```

**å…³é”®å®ç°ç»†èŠ‚**:

1. **åŠ¨æ€å¯¼å…¥è§„é¿ SSR**: ä½¿ç”¨ `await import("@mediapipe/tasks-vision")` ç¡®ä¿ä»…åœ¨å®¢æˆ·ç«¯åŠ è½½
2. **WASM åŠ è½½**: é€šè¿‡ CDN åŠ è½½ (`cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/wasm`)ï¼Œé¿å…å¤æ‚çš„æœ¬åœ° WASM é…ç½®
3. **æ¨¡å‹æ–‡ä»¶**: ä½¿ç”¨ `pose_landmarker_lite` æ¨¡å‹(æœ€å¿«)ï¼Œé€šè¿‡ Google Storage CDN åŠ è½½
4. **è¿è¡Œæ¨¡å¼**: ä½¿ç”¨ `VIDEO` æ¨¡å¼ + `detectForVideo(video, timestamp)` è¿›è¡Œé€å¸§æ£€æµ‹
5. **å¸§ç‡æ§åˆ¶**: å§¿æ€æ£€æµ‹ä»¥ 30fps è¿è¡Œ(èŠ‚çœ CPU)ï¼Œæ¸¸æˆæ¸²æŸ“ä»¥ 60fps è¿è¡Œ

**ä½¿ç”¨çš„å…³é”®ç‚¹ç¼–å·**:

| ç¼–å· | åç§° | ç”¨é€” |
|-----|------|------|
| 11 | å·¦è‚© | è·³è·ƒ/è¹²ä¸‹æ£€æµ‹ |
| 12 | å³è‚© | è·³è·ƒ/è¹²ä¸‹æ£€æµ‹ |
| 23 | å·¦é«‹ | è¾…åŠ©åˆ¤å®š |
| 24 | å³é«‹ | è¾…åŠ©åˆ¤å®š |
| 25 | å·¦è† | è¹²ä¸‹è¾…åŠ©åˆ¤å®š |
| 26 | å³è† | è¹²ä¸‹è¾…åŠ©åˆ¤å®š |

#### 3.3.2 åŠ¨ä½œè¯†åˆ«å¼•æ“ (`lib/gesture-engine.ts`)

**èŒè´£**: å°†åŸå§‹å…³é”®ç‚¹æ•°æ®è½¬åŒ–ä¸ºæ¸¸æˆæŒ‡ä»¤

```typescript
enum GestureType {
  IDLE = 'IDLE',
  JUMP = 'JUMP',
  DUCK = 'DUCK',
}

interface GestureState {
  type: GestureType;
  confidence: number;   // 0-1 è¯†åˆ«ç½®ä¿¡åº¦
  duration: number;     // å½“å‰çŠ¶æ€æŒç»­æ—¶é—´(ms)
}
```

**åŠ¨ä½œæ£€æµ‹ç®—æ³•**:

æ ¸å¿ƒæ€è·¯: è¿½è¸ªè‚©éƒ¨ä¸­ç‚¹çš„ Y åæ ‡ç›¸å¯¹äºåŸºå‡†çº¿çš„åç§»é‡ã€‚

```
åŸºå‡†çº¿(baseline) = ç«™ç«‹æ—¶è‚©éƒ¨ä¸­ç‚¹ Y åæ ‡çš„æ»‘åŠ¨å¹³å‡å€¼

shoulderMidY = (leftShoulder.y + rightShoulder.y) / 2

if (baseline - shoulderMidY > JUMP_THRESHOLD):
    gesture = JUMP
elif (shoulderMidY - baseline > DUCK_THRESHOLD):
    gesture = DUCK
else:
    gesture = IDLE
```

**æ³¨æ„**: MediaPipe å½’ä¸€åŒ–åæ ‡ä¸­ï¼ŒY è½´å‘ä¸‹ä¸ºæ­£ï¼Œæ‰€ä»¥:
- è·³è·ƒæ—¶è‚©éƒ¨ Y å€¼**å‡å°**(äººå¾€ä¸Šè·³ï¼Œåœ¨ç”»é¢ä¸­ä½ç½®ä¸Šç§»)
- è¹²ä¸‹æ—¶è‚©éƒ¨ Y å€¼**å¢å¤§**(äººå¾€ä¸‹è¹²ï¼Œåœ¨ç”»é¢ä¸­ä½ç½®ä¸‹ç§»)

**å…³é”®å‚æ•°**(é’ˆå¯¹ 3 å²å¹¼å„¿è°ƒä¼˜):

| å‚æ•° | å€¼ | è¯´æ˜ |
|-----|---|------|
| JUMP_THRESHOLD | 0.06 | å½’ä¸€åŒ–åæ ‡åç§»é‡ï¼Œçº¦ä¸ºç”»é¢é«˜åº¦çš„ 6% |
| DUCK_THRESHOLD | 0.05 | å½’ä¸€åŒ–åæ ‡åç§»é‡ï¼Œçº¦ä¸ºç”»é¢é«˜åº¦çš„ 5% |
| BASELINE_SMOOTHING | 0.95 | åŸºå‡†çº¿æŒ‡æ•°æ»‘åŠ¨å¹³å‡ç³»æ•° |
| CALIBRATION_FRAMES | 30 | æ ¡å‡†å¸§æ•°(çº¦ 1 ç§’) |
| DEBOUNCE_MS | 200 | çŠ¶æ€åˆ‡æ¢å»æŠ–æ—¶é—´ |
| COOLDOWN_MS | 500 | è·³è·ƒåå†·å´æ—¶é—´ï¼Œé˜²æ­¢è¿è·³ |

**æ ¡å‡†æµç¨‹**:
1. æ£€æµ‹åˆ°äººä½“åï¼Œå‰ 30 å¸§(çº¦ 1 ç§’)æ”¶é›†è‚©éƒ¨ Y åæ ‡
2. è®¡ç®—å¹³å‡å€¼ä½œä¸ºåˆå§‹åŸºå‡†çº¿
3. ä¹‹åæŒç»­ä»¥æŒ‡æ•°æ»‘åŠ¨å¹³å‡æ›´æ–°åŸºå‡†çº¿
4. åŸºå‡†çº¿æ›´æ–°åªåœ¨ IDLE çŠ¶æ€ä¸‹è¿›è¡Œï¼Œé¿å…è·³è·ƒ/è¹²ä¸‹æ—¶æ±¡æŸ“åŸºå‡†

#### 3.3.3 æ¸¸æˆå¼•æ“ (`lib/game-engine.ts`)

**èŒè´£**: Chrome Dino é£æ ¼çš„æ¨ªç‰ˆè·‘é…·æ¸¸æˆé€»è¾‘å’Œæ¸²æŸ“

```typescript
interface GameConfig {
  // é€Ÿåº¦å‚æ•°(ç›¸å¯¹äºåŸç‰ˆé™ä½ 50%)
  initialSpeed: number;      // 3 (åŸç‰ˆ 6)
  maxSpeed: number;           // 7 (åŸç‰ˆ 13)
  acceleration: number;       // 0.0003 (åŸç‰ˆ 0.001)

  // ç‰©ç†å‚æ•°
  gravity: number;            // 0.4 (åŸç‰ˆ 0.6, é™ä½ä½¿è·³è·ƒæ›´é£˜)
  jumpVelocity: number;       // 10 (åŸç‰ˆ 12)

  // éšœç¢ç‰©å‚æ•°
  minObstacleInterval: number; // 3000ms (åŸç‰ˆçº¦ 1500ms)
  maxObstacleInterval: number; // 5000ms
  collisionShrink: number;    // 0.4 (ç¢°æ’æ¡†ç¼©å° 40%)

  // ç¿¼é¾™å‡ºç°é˜ˆå€¼
  pterodactylScoreThreshold: number; // 200 (åŸç‰ˆçº¦ 450)
}

interface GameState {
  status: 'waiting' | 'calibrating' | 'playing' | 'crashed' | 'restarting';
  score: number;
  highScore: number;
  speed: number;
  dino: DinoState;
  obstacles: Obstacle[];
  ground: GroundState;
  clouds: Cloud[];
  particles: Particle[];  // ç¢°æ’æ˜Ÿæ˜Ÿç‰¹æ•ˆ
}
```

**æ¸¸æˆå¾ªç¯(Game Loop)**:

```
requestAnimationFrame(loop)
    |
    +--> 1. è®¡ç®— deltaTime
    |
    +--> 2. è¯»å–å½“å‰ gesture (æ¥è‡ª Gesture Engine)
    |
    +--> 3. æ›´æ–°æé¾™çŠ¶æ€
    |       - JUMP gesture + åœ¨åœ°é¢ => è®¾ç½®è·³è·ƒé€Ÿåº¦
    |       - DUCK gesture => åˆ‡æ¢è¹²ä¸‹å§¿æ€
    |       - åº”ç”¨é‡åŠ›å’Œä½ç§»
    |
    +--> 4. æ›´æ–°éšœç¢ç‰©
    |       - ç§»åŠ¨ç°æœ‰éšœç¢ç‰©
    |       - ç§»é™¤è¶…å‡ºå±å¹•çš„
    |       - æŒ‰é—´éš”ç”Ÿæˆæ–°éšœç¢ç‰©
    |
    +--> 5. ç¢°æ’æ£€æµ‹
    |       - AABB ç¢°æ’ï¼Œç¢°æ’æ¡†ç¼©å° 40%
    |       - ç¢°æ’ => åˆ‡æ¢åˆ° crashed çŠ¶æ€
    |
    +--> 6. æ›´æ–°åˆ†æ•°
    |
    +--> 7. æ¸²æŸ“æ‰€æœ‰å…ƒç´ 
            - èƒŒæ™¯(å¤©ç©ºæ¸å˜ã€äº‘æœµã€è¿œå±±)
            - åœ°é¢(æ»šåŠ¨çº¹ç†)
            - éšœç¢ç‰©
            - æé¾™
            - åˆ†æ•°
            - ç‰¹æ•ˆç²’å­
```

**ä¸åŸç‰ˆ Chrome Dino çš„å…³é”®å·®å¼‚**:

| ç»´åº¦ | åŸç‰ˆ | Motion Dino |
|-----|------|-------------|
| é€Ÿåº¦ | 6-13 | 3-7 (æ…¢ 50%) |
| åŠ é€Ÿåº¦ | 0.001 | 0.0003 (æ…¢ 70%) |
| é‡åŠ› | 0.6 | 0.4 (æ›´é£˜) |
| éšœç¢é—´éš” | ~1.5s | 3-5s (å®½æ¾) |
| ç¢°æ’æ¡† | 1px ç¼©å‡ | 40% ç¼©å‡ |
| ç¿¼é¾™å‡ºç° | ~450 åˆ† | 200 åˆ† |
| Game Over | æ˜¾ç¤ºæ–‡å­—+æŒ‰é”®é‡å¼€ | åŠ¨ç”»+è‡ªåŠ¨é‡å¼€ |
| è§†è§‰é£æ ¼ | ç°è‰²åƒç´  | å½©è‰²å¡é€š |
| èƒŒæ™¯ | ç™½è‰²/æ·±è‰²åˆ‡æ¢ | è“å¤©ç™½äº‘ |

#### 3.3.4 ç²¾çµç»˜åˆ¶æ¨¡å— (`lib/sprites.ts`)

**èŒè´£**: ä½¿ç”¨ Canvas 2D API ç»˜åˆ¶æ‰€æœ‰æ¸¸æˆå…ƒç´ 

æ‰€æœ‰å…ƒç´ ä½¿ç”¨**çŸ¢é‡ç»˜åˆ¶**(arc, bezierCurveTo, fillRect ç­‰)ï¼Œä¼˜åŠ¿:
- æ— éœ€åŠ è½½å¤–éƒ¨å›¾ç‰‡èµ„æº
- å¯éšæ„ç¼©æ”¾ä¸å¤±çœŸ
- ä¾¿äºä¿®æ”¹é¢œè‰²å’Œå°ºå¯¸
- é¦–å±åŠ è½½æ›´å¿«

**ç»˜åˆ¶å‡½æ•°åˆ—è¡¨**:

```typescript
// æé¾™ç³»åˆ—
function drawDinoRunning(ctx: CanvasRenderingContext2D, x: number, y: number, frame: number, scale: number): void;
function drawDinoJumping(ctx: CanvasRenderingContext2D, x: number, y: number, scale: number): void;
function drawDinoDucking(ctx: CanvasRenderingContext2D, x: number, y: number, frame: number, scale: number): void;
function drawDinoCrashed(ctx: CanvasRenderingContext2D, x: number, y: number, frame: number, scale: number): void;

// éšœç¢ç‰©ç³»åˆ—
function drawCactus(ctx: CanvasRenderingContext2D, x: number, y: number, size: 'small' | 'large', scale: number): void;
function drawPterodactyl(ctx: CanvasRenderingContext2D, x: number, y: number, frame: number, scale: number): void;

// èƒŒæ™¯ç³»åˆ—
function drawSky(ctx: CanvasRenderingContext2D, width: number, height: number): void;
function drawCloud(ctx: CanvasRenderingContext2D, x: number, y: number, scale: number): void;
function drawMountain(ctx: CanvasRenderingContext2D, x: number, y: number, scale: number): void;
function drawGround(ctx: CanvasRenderingContext2D, width: number, y: number, offset: number): void;

// ç‰¹æ•ˆç³»åˆ—
function drawStarParticle(ctx: CanvasRenderingContext2D, x: number, y: number, size: number, opacity: number): void;
function drawConfetti(ctx: CanvasRenderingContext2D, particles: ConfettiParticle[]): void;
```

#### 3.3.5 å¸¸é‡é…ç½® (`lib/constants.ts`)

é›†ä¸­ç®¡ç†æ‰€æœ‰å¯è°ƒå‚æ•°ï¼Œä¾¿äºå¿«é€Ÿè°ƒä¼˜:

```typescript
export const GAME_CONFIG = {
  // ç”»å¸ƒ
  CANVAS_ASPECT_RATIO: 3,      // å®½é«˜æ¯” 3:1
  GROUND_RATIO: 0.8,           // åœ°é¢çº¿åœ¨ Canvas 80% é«˜åº¦å¤„

  // é€Ÿåº¦
  INITIAL_SPEED: 3,
  MAX_SPEED: 7,
  ACCELERATION: 0.0003,

  // ç‰©ç†
  GRAVITY: 0.4,
  JUMP_VELOCITY: -10,          // è´Ÿå€¼è¡¨ç¤ºå‘ä¸Š

  // éšœç¢ç‰©
  MIN_OBSTACLE_GAP_MS: 3000,
  MAX_OBSTACLE_GAP_MS: 5000,
  COLLISION_SHRINK: 0.4,
  PTERODACTYL_SCORE_THRESHOLD: 200,

  // æé¾™
  DINO_WIDTH: 60,
  DINO_HEIGHT: 70,
  DINO_DUCK_HEIGHT: 40,

  // è‡ªåŠ¨é‡å¼€
  RESTART_DELAY_MS: 2500,

  // é‡Œç¨‹ç¢‘
  MILESTONE_INTERVAL: 100,
} as const;

export const POSE_CONFIG = {
  MODEL_PATH: 'https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task',
  WASM_PATH: 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/wasm',
  DETECTION_FPS: 30,
  MIN_DETECTION_CONFIDENCE: 0.5,
  MIN_TRACKING_CONFIDENCE: 0.5,
} as const;

export const GESTURE_CONFIG = {
  JUMP_THRESHOLD: 0.06,
  DUCK_THRESHOLD: 0.05,
  BASELINE_SMOOTHING: 0.95,
  CALIBRATION_FRAMES: 30,
  DEBOUNCE_MS: 200,
  COOLDOWN_MS: 500,
} as const;

export const COLORS = {
  SKY: '#87CEEB',
  SKY_BOTTOM: '#E8F4FD',
  GROUND: '#F4D03F',
  GROUND_DARK: '#D4AC0D',
  DINO_BODY: '#2ECC71',
  DINO_BELLY: '#F9E79F',
  DINO_EYE: '#2C3E50',
  CACTUS: '#27AE60',
  CACTUS_DARK: '#1E8449',
  PTERODACTYL: '#8E44AD',
  PTERODACTYL_LIGHT: '#BB8FCE',
  SCORE: '#E67E22',
  CLOUD: '#FFFFFF',
  MOUNTAIN: '#D5DBDB',
} as const;
```

### 3.4 æ–‡ä»¶ç»“æ„

```
motion-dino/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx              # æ ¹å¸ƒå±€(å­—ä½“ã€metadata)
â”‚   â”œâ”€â”€ page.tsx                # é¦–é¡µ(å¼•å¯¼é¡µ/æ¸¸æˆé¡µåˆ‡æ¢)
â”‚   â””â”€â”€ globals.css             # Tailwind å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ GameContainer.tsx       # æ¸¸æˆä¸»å®¹å™¨(æ•´åˆæ‰€æœ‰æ¨¡å—)
â”‚   â”œâ”€â”€ GameCanvas.tsx          # Canvas æ¸¸æˆç”»é¢ç»„ä»¶
â”‚   â”œâ”€â”€ WebcamPreview.tsx       # æ‘„åƒå¤´é¢„è§ˆå°çª—ç»„ä»¶
â”‚   â”œâ”€â”€ StartScreen.tsx         # å¼€å§‹å¼•å¯¼é¡µç»„ä»¶
â”‚   â”œâ”€â”€ ScoreDisplay.tsx        # åˆ†æ•°æ˜¾ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ GestureIndicator.tsx    # åŠ¨ä½œåé¦ˆæŒ‡ç¤ºå™¨ç»„ä»¶
â”‚   â”œâ”€â”€ CalibrationOverlay.tsx  # æ ¡å‡†æç¤ºè¦†ç›–å±‚ç»„ä»¶
â”‚   â””â”€â”€ MilestoneEffect.tsx     # é‡Œç¨‹ç¢‘åº†ç¥ç‰¹æ•ˆç»„ä»¶
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ pose-detector.ts        # MediaPipe å§¿æ€æ£€æµ‹å°è£…
â”‚   â”œâ”€â”€ gesture-engine.ts       # åŠ¨ä½œè¯†åˆ«å¼•æ“
â”‚   â”œâ”€â”€ game-engine.ts          # æ¸¸æˆæ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ sprites.ts              # Canvas ç²¾çµç»˜åˆ¶å‡½æ•°
â”‚   â”œâ”€â”€ audio.ts                # éŸ³æ•ˆç®¡ç†å™¨
â”‚   â”œâ”€â”€ constants.ts            # å…¨å±€å¸¸é‡é…ç½®
â”‚   â””â”€â”€ types.ts                # TypeScript ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ usePoseDetection.ts     # å§¿æ€æ£€æµ‹ Hook
â”‚   â”œâ”€â”€ useGameLoop.ts          # æ¸¸æˆå¾ªç¯ Hook
â”‚   â”œâ”€â”€ useWebcam.ts            # æ‘„åƒå¤´ç®¡ç† Hook
â”‚   â””â”€â”€ useAudio.ts             # éŸ³é¢‘ç®¡ç† Hook
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ sounds/                 # éŸ³æ•ˆæ–‡ä»¶(å¯é€‰)
â”‚       â”œâ”€â”€ jump.mp3
â”‚       â”œâ”€â”€ score.mp3
â”‚       â””â”€â”€ crash.mp3
â”‚
â”œâ”€â”€ next.config.ts              # Next.js é…ç½®
â”œâ”€â”€ tailwind.config.ts          # Tailwind é…ç½®
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ DEVELOPMENT.md              # æœ¬æ–‡æ¡£
```

### 3.5 çŠ¶æ€ç®¡ç†

ä¸ä½¿ç”¨ Redux/Zustand ç­‰çŠ¶æ€åº“ï¼Œæ‰€æœ‰æ¸¸æˆçŠ¶æ€ä½¿ç”¨ `useRef` ç®¡ç†ä»¥é¿å… React é‡æ¸²æŸ“:

```typescript
// æ ¸å¿ƒçŠ¶æ€æµ (æ‰€æœ‰é€šè¿‡ useRef ç®¡ç†)
const gestureRef = useRef<GestureType>(GestureType.IDLE);
const gameStateRef = useRef<GameState>(initialGameState);
const poseResultRef = useRef<PoseResult | null>(null);

// ä»…éœ€è¦è§¦å‘ UI æ›´æ–°çš„çŠ¶æ€ä½¿ç”¨ useState
const [score, setScore] = useState(0);
const [gameStatus, setGameStatus] = useState<GameStatus>('waiting');
const [detectionStatus, setDetectionStatus] = useState<DetectionStatus>('loading');
```

**çŠ¶æ€æµæ•°æ®è·¯å¾„**:

```
MediaPipe --> poseResultRef --> gestureEngine --> gestureRef --> gameEngine --> gameStateRef
                                                                    |
                                                                    +--> setScore() (ä»…æ•´æ•°å˜åŒ–æ—¶)
                                                                    +--> setGameStatus() (ä»…çŠ¶æ€åˆ‡æ¢æ—¶)
```

### 3.6 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ |
|-----|------|
| åŒå¸§ç‡åˆ†ç¦» | å§¿æ€æ£€æµ‹ 30fpsï¼Œæ¸¸æˆæ¸²æŸ“ 60fpsï¼Œäº’ä¸é˜»å¡ |
| Ref é©±åŠ¨ | æ¸¸æˆçŠ¶æ€å…¨éƒ¨ç”¨ useRefï¼Œé¿å… React é‡æ¸²æŸ“ |
| åŠ¨æ€å¯¼å…¥ | MediaPipe æ¨¡å—åŠ¨æ€å¯¼å…¥ï¼Œä¸å½±å“é¦–å± |
| GPU åŠ é€Ÿ | MediaPipe ä½¿ç”¨ GPU delegate(M3 Max æœ‰ 40 æ ¸ GPU) |
| ç¦»å±ç¼“å­˜ | é™æ€èƒŒæ™¯å…ƒç´ (å¤©ç©ºæ¸å˜ã€å±±ä¸˜)ä½¿ç”¨ OffscreenCanvas é¢„æ¸²æŸ“ |
| æ•´æ•°åæ ‡ | Canvas ç»˜åˆ¶ä½¿ç”¨ Math.round() é¿å…äºšåƒç´ æ¨¡ç³Š |
| å¯¹è±¡æ±  | éšœç¢ç‰©å’Œç²’å­ä½¿ç”¨å¯¹è±¡æ± ï¼Œé¿å… GC æŠ–åŠ¨ |
| Lite æ¨¡å‹ | ä½¿ç”¨ pose_landmarker_lite(æœ€å¿«æ¨¡å‹) |

---

## å››ã€å®ç°è·¯å¾„

### Phase 1: é¡¹ç›®æ­å»º (é¢„è®¡ 0.5 å¤©)

**Step 1.1** - åˆå§‹åŒ– Next.js 15 é¡¹ç›®
```bash
npx create-next-app@latest motion-dino --typescript --tailwind --app --use-npm --no-src-dir
cd motion-dino
npx shadcn@latest init
```

**Step 1.2** - å®‰è£…ä¾èµ–
```bash
npm install @mediapipe/tasks-vision framer-motion
npx shadcn@latest add button card badge
```

**Step 1.3** - é…ç½®é¡¹ç›®ç»“æ„
- åˆ›å»º `lib/`, `hooks/`, `components/` ç›®å½•
- é…ç½® `lib/constants.ts` å’Œ `lib/types.ts`
- é…ç½® `next.config.ts` (å¦‚æœ‰å¿…è¦)
- åœ¨ `next.config.ts` ä¸­æ”¾å¼€ MediaPipe è¿œç¨‹èµ„æºåŸŸåï¼ˆå¦‚ä½¿ç”¨ `images` æˆ– CSPï¼‰

**äº¤ä»˜ç‰©**: å¯è¿è¡Œçš„ç©ºç™½ Next.js é¡¹ç›®ï¼Œæ‰€æœ‰ä¾èµ–å®‰è£…å®Œæ¯•

---

### Phase 2: æ‘„åƒå¤´å’Œå§¿æ€æ£€æµ‹ (é¢„è®¡ 1 å¤©)

**Step 2.1** - å®ç° `hooks/useWebcam.ts`
- getUserMedia è·å–æ‘„åƒå¤´æµ
- å¤„ç†æƒé™è¯·æ±‚å’Œé”™è¯¯
- ç»„ä»¶å¸è½½æ—¶æ¸…ç†æµ

**Step 2.2** - å®ç° `lib/pose-detector.ts`
- åŠ¨æ€å¯¼å…¥ MediaPipe
- åˆå§‹åŒ– PoseLandmarker (WASM + æ¨¡å‹åŠ è½½)
- å°è£… detectForVideo è°ƒç”¨
- è¾“å‡º 33 ä¸ªå…³é”®ç‚¹æ•°æ®
- åˆå§‹åŒ–å¤±è´¥æ—¶è¿”å›å¯æ¢å¤é”™è¯¯ç ï¼ˆç½‘ç»œå¤±è´¥ / æƒé™å¤±è´¥ / ä¸æ”¯æŒï¼‰

**Step 2.3** - å®ç° `hooks/usePoseDetection.ts`
- æ•´åˆ useWebcam å’Œ pose-detector
- 30fps å¸§ç‡æ§åˆ¶
- çŠ¶æ€ç®¡ç†(åŠ è½½ä¸­/å°±ç»ª/æ£€æµ‹ä¸­/é”™è¯¯)
- é¡µé¢åˆ‡åå°æ—¶æš‚åœæ£€æµ‹ï¼Œå›å‰å°è‡ªåŠ¨æ¢å¤

**Step 2.4** - å®ç° `components/WebcamPreview.tsx`
- æ˜¾ç¤ºæ‘„åƒå¤´é•œåƒç”»é¢
- å¯é€‰å åŠ éª¨éª¼çº¿
- æ£€æµ‹çŠ¶æ€è¾¹æ¡†é¢œè‰²

**éªŒè¯**: æ‰“å¼€é¡µé¢åæ‘„åƒå¤´æ¿€æ´»ï¼Œæ§åˆ¶å°è¾“å‡ºå…³é”®ç‚¹åæ ‡ï¼Œé¢„è§ˆçª—å£æ˜¾ç¤ºé•œåƒç”»é¢å’Œéª¨éª¼çº¿

---

### Phase 3: åŠ¨ä½œè¯†åˆ« (é¢„è®¡ 0.5 å¤©)

**Step 3.1** - å®ç° `lib/gesture-engine.ts`
- åŸºå‡†çº¿æ ¡å‡†é€»è¾‘
- è·³è·ƒæ£€æµ‹(è‚©éƒ¨ Y ä¸Šç§»)
- è¹²ä¸‹æ£€æµ‹(è‚©éƒ¨ Y ä¸‹ç§»)
- å»æŠ–å’Œå†·å´é€»è¾‘

**Step 3.2** - å®ç° `components/CalibrationOverlay.tsx`
- æ ¡å‡†å€’è®¡æ—¶æ˜¾ç¤º
- "è¯·ç«™å¥½" æç¤º

**Step 3.3** - å®ç° `components/GestureIndicator.tsx`
- æ˜¾ç¤ºå½“å‰æ£€æµ‹åˆ°çš„åŠ¨ä½œ
- ç®­å¤´åŠ¨ç”»åé¦ˆ

**éªŒè¯**: äººç«™åœ¨æ‘„åƒå¤´å‰è·³è·ƒ/è¹²ä¸‹ï¼ŒUI ä¸Šæ­£ç¡®æ˜¾ç¤ºå¯¹åº”åŠ¨ä½œï¼Œå“åº”å»¶è¿Ÿ < 200ms

---

### Phase 4: æ¸¸æˆå¼•æ“æ ¸å¿ƒ (é¢„è®¡ 1.5 å¤©)

**Step 4.1** - å®ç° `lib/sprites.ts`
- ç»˜åˆ¶æé¾™(å¥”è·‘ã€è·³è·ƒã€è¹²ä¸‹ã€ç¢°æ’å„çŠ¶æ€)
- ç»˜åˆ¶ä»™äººæŒ(å¤§ã€å°)
- ç»˜åˆ¶ç¿¼é¾™(å¸¦ç¿…è†€åŠ¨ç”»)
- ç»˜åˆ¶èƒŒæ™¯(å¤©ç©ºã€äº‘ã€å±±ã€åœ°é¢)

**Step 4.2** - å®ç° `lib/game-engine.ts`
- æ¸¸æˆçŠ¶æ€æœº(waiting -> calibrating -> playing -> crashed -> restarting -> playing)
- æé¾™ç‰©ç†(è·³è·ƒã€é‡åŠ›ã€è¹²ä¸‹)
- éšœç¢ç‰©ç”Ÿæˆå’Œç§»åŠ¨
- ç¢°æ’æ£€æµ‹(ç¼©å°ç¢°æ’æ¡†)
- è®¡åˆ†ç³»ç»Ÿ
- è‡ªåŠ¨é‡å¼€é€»è¾‘

**Step 4.3** - å®ç° `hooks/useGameLoop.ts`
- requestAnimationFrame å¾ªç¯
- deltaTime è®¡ç®—
- è¯»å– gestureRef é©±åŠ¨æé¾™

**Step 4.4** - å®ç° `components/GameCanvas.tsx`
- Canvas å…ƒç´ ç®¡ç†
- è‡ªé€‚åº”å°ºå¯¸
- æ¸¸æˆæ¸²æŸ“è°ƒç”¨

**éªŒè¯**: æ¸¸æˆç”»é¢æ­£å¸¸è¿è¡Œï¼Œæé¾™å¯ä»¥é€šè¿‡é”®ç›˜ (Space/Down) æ§åˆ¶è·³è·ƒå’Œè¹²ä¸‹(å…ˆéªŒè¯æ¸¸æˆé€»è¾‘)

---

### Phase 5: æ•´åˆä½“æ„Ÿæ§åˆ¶ (é¢„è®¡ 0.5 å¤©)

**Step 5.1** - å®ç° `components/GameContainer.tsx`
- æ•´åˆå§¿æ€æ£€æµ‹ -> åŠ¨ä½œè¯†åˆ« -> æ¸¸æˆå¼•æ“
- å°† gestureRef è¿æ¥åˆ°æ¸¸æˆè¾“å…¥
- åŒæ—¶ä¿ç•™é”®ç›˜è¾“å…¥ä½œä¸ºå¤‡é€‰

**Step 5.2** - çŠ¶æ€åŒæ­¥
- å§¿æ€æ£€æµ‹çŠ¶æ€é©±åŠ¨ UI æç¤º
- æ¸¸æˆçŠ¶æ€é©±åŠ¨ UI æ›´æ–°(åˆ†æ•°ã€çŠ¶æ€)

**éªŒè¯**: ç«™åœ¨æ‘„åƒå¤´å‰ï¼Œè·³è·ƒä½¿æé¾™è·³èµ·ï¼Œè¹²ä¸‹ä½¿æé¾™ä½å¤´ï¼Œæ¸¸æˆå®Œæ•´å¯ç©

---

### Phase 6: UI ç¾åŒ–å’Œå¼•å¯¼ (é¢„è®¡ 1 å¤©)

**Step 6.1** - å®ç° `components/StartScreen.tsx`
- å¡é€šå¼•å¯¼å›¾ç¤º
- æ‘„åƒå¤´æƒé™è¯·æ±‚é›†æˆ
- å¼€å§‹æŒ‰é’®(å¤§å°ºå¯¸ã€åŠ¨ç”»)

**Step 6.2** - å®ç° `components/ScoreDisplay.tsx`
- å¤§å­—ä½“åˆ†æ•°æ˜¾ç¤º
- åˆ†æ•°å˜åŒ–åŠ¨ç”»

**Step 6.3** - å®ç° `components/MilestoneEffect.tsx`
- æ¯ 100 åˆ†åº†ç¥åŠ¨ç”»
- æ˜Ÿæ˜Ÿ/å½©å¸¦ç²’å­æ•ˆæœ

**Step 6.4** - æ•´ä½“ UI æ‰“ç£¨
- shadcn/ui ç»„ä»¶æ ·å¼è¦†ç›–
- Framer Motion è¿‡æ¸¡åŠ¨ç”»
- èƒŒæ™¯æ¸å˜å’Œè£…é¥°å…ƒç´ 
- å­—ä½“é€‰æ‹©(åœ†æ¶¦çš„æ— è¡¬çº¿ä½“)

**Step 6.5** - éŸ³æ•ˆç³»ç»Ÿ (å¯é€‰)
- å®ç° `lib/audio.ts` å’Œ `hooks/useAudio.ts`
- è·³è·ƒéŸ³æ•ˆã€å¾—åˆ†éŸ³æ•ˆã€ç¢°æ’éŸ³æ•ˆ
- èƒŒæ™¯éŸ³ä¹(å¾ªç¯ã€ä½éŸ³é‡)

**éªŒè¯**: å®Œæ•´çš„è§†è§‰ä½“éªŒï¼Œå¼•å¯¼æµç¨‹é¡ºç•…ï¼ŒåŠ¨ç”»æµç•…ï¼ŒéŸ³æ•ˆåŒ¹é…

---

### Phase 7: è°ƒä¼˜å’Œæµ‹è¯• (é¢„è®¡ 0.5 å¤©)

**Step 7.1** - å„¿ç«¥é€‚é…è°ƒä¼˜
- è°ƒæ•´ JUMP_THRESHOLD å’Œ DUCK_THRESHOLD
- è°ƒæ•´æ¸¸æˆé€Ÿåº¦å’Œéšœç¢é—´éš”
- è°ƒæ•´ç¢°æ’åˆ¤å®šå®½æ¾åº¦
- æµ‹è¯•ä¸åŒèº«é«˜(è®©å­©å­ç«™ä¸åŒè·ç¦»)

**Step 7.2** - æ€§èƒ½ä¼˜åŒ–
- Chrome DevTools Performance åˆ†æ
- ç¡®ä¿æ¸¸æˆå¸§ç‡ç¨³å®š 60fps
- ç¡®ä¿å§¿æ€æ£€æµ‹å»¶è¿Ÿåœ¨å¸¸è§„å…‰ç…§ä¸‹ç¨³å®š < 150msï¼ˆéªŒæ”¶ä¸Šé™ 200msï¼‰

**Step 7.3** - è¾¹ç¼˜æƒ…å†µå¤„ç†
- æ‘„åƒå¤´æƒé™æ‹’ç» -> é™çº§ä¸ºé”®ç›˜æ¨¡å¼
- äººç¦»å¼€ç”»é¢ -> æš‚åœæ¸¸æˆ + æç¤º
- å¤šäººå‡ºç°åœ¨ç”»é¢ä¸­ -> åªè¿½è¸ªç¬¬ä¸€ä¸ªäºº
- å…‰çº¿ä¸è¶³ -> æç¤ºæ”¹å–„å…‰çº¿

---

## äº”ã€éªŒæ”¶æ–¹æ¡ˆ

### 5.1 åŠŸèƒ½éªŒæ”¶

| ç¼–å· | éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† | ä¼˜å…ˆçº§ |
|-----|-------|---------|-------|
| F01 | æ‘„åƒå¤´å¯åŠ¨ | ç‚¹å‡»"å¼€å§‹ç©"å 3 ç§’å†…æ‘„åƒå¤´æ¿€æ´»å¹¶æ˜¾ç¤ºé¢„è§ˆ | P0 |
| F02 | å§¿æ€æ£€æµ‹ | æ£€æµ‹åˆ°äººä½“åé¢„è§ˆçª—å£æ˜¾ç¤ºç»¿è‰²è¾¹æ¡† | P0 |
| F03 | è·³è·ƒæ£€æµ‹ | äººè·³èµ·å 200ms å†…æé¾™èµ·è·³ | P0 |
| F04 | è¹²ä¸‹æ£€æµ‹ | äººè¹²ä¸‹å 200ms å†…æé¾™ä½å¤´ | P0 |
| F05 | æ¸¸æˆè¿è¡Œ | æé¾™è‡ªåŠ¨å¥”è·‘ï¼Œéšœç¢ç‰©ä»å³å‘å·¦ç§»åŠ¨ | P0 |
| F06 | ç¢°æ’æ£€æµ‹ | æé¾™ç¢°åˆ°éšœç¢ç‰©åè§¦å‘ç¢°æ’åŠ¨ç”» | P0 |
| F07 | è‡ªåŠ¨é‡å¼€ | ç¢°æ’å 2.5 ç§’è‡ªåŠ¨é‡æ–°å¼€å§‹ | P0 |
| F08 | è®¡åˆ† | åˆ†æ•°éšè·ç¦»æŒç»­å¢é•¿ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ–¹ | P0 |
| F09 | å¼•å¯¼é¡µ | é¦–æ¬¡è¿›å…¥æ˜¾ç¤ºå›¾ç¤ºå¼•å¯¼ï¼Œç‚¹å‡»å¼€å§‹æŒ‰é’®è¿›å…¥æ¸¸æˆ | P1 |
| F10 | é‡Œç¨‹ç¢‘åº†ç¥ | æ¯ 100 åˆ†è§¦å‘æ˜Ÿæ˜Ÿ/å½©å¸¦ç‰¹æ•ˆ | P1 |
| F11 | é”®ç›˜å¤‡é€‰ | Space è·³è·ƒï¼ŒDown è¹²ä¸‹ï¼Œä½œä¸ºå¤‡é€‰è¾“å…¥ | P1 |
| F12 | æ‘„åƒå¤´é•œåƒ | é¢„è§ˆç”»é¢æ°´å¹³é•œåƒï¼ŒåŠ¨ä½œæ–¹å‘ç›´è§‰ä¸€è‡´ | P1 |
| F13 | æ ¡å‡†æµç¨‹ | å¼€å§‹æ¸¸æˆå‰ 1 ç§’è‡ªåŠ¨æ ¡å‡†ç«™ç«‹åŸºå‡†çº¿ | P1 |
| F14 | æ£€æµ‹çŠ¶æ€ | é¢„è§ˆçª—å£è¾¹æ¡†é¢œè‰²æŒ‡ç¤ºæ£€æµ‹çŠ¶æ€(ç»¿/é»„/çº¢) | P2 |
| F15 | éŸ³æ•ˆ | è·³è·ƒã€å¾—åˆ†ã€ç¢°æ’é…æœ‰éŸ³æ•ˆ | P2 |
| F16 | å¼‚å¸¸å¤„ç† | äººç¦»å¼€ç”»é¢æ—¶æš‚åœï¼Œæ‘„åƒå¤´è¢«æ‹’ç»æ—¶é™çº§ä¸ºé”®ç›˜æ¨¡å¼ | P2 |

### 5.2 æ€§èƒ½éªŒæ”¶

| ç¼–å· | éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† |
|-----|-------|---------|
| P01 | æ¸¸æˆå¸§ç‡ | ç¨³å®š >= 55fps (M3 Max Chrome) |
| P02 | å§¿æ€å»¶è¿Ÿ | ä»èº«ä½“è¿åŠ¨åˆ°æé¾™å“åº” < 200ms |
| P03 | æ¨¡å‹åŠ è½½ | MediaPipe æ¨¡å‹åŠ è½½ < 5 ç§’(é¦–æ¬¡ï¼Œå«ç½‘ç»œ) |
| P04 | é¦–å±æ¸²æŸ“ | å¼•å¯¼é¡µé¢åŠ è½½ < 2 ç§’ |
| P05 | å†…å­˜å ç”¨ | è¿è¡Œ 10 åˆ†é’Ÿåå†…å­˜æ— æ˜æ˜¾æ³„æ¼ |

### 5.3 UX éªŒæ”¶

| ç¼–å· | éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† |
|-----|-------|---------|
| U01 | 3 å²å¯ç©æ€§ | 3 å²å„¿ç«¥åœ¨å®¶é•¿å¼•å¯¼ä¸‹ 1 åˆ†é’Ÿå†…ç†è§£ç©æ³• |
| U02 | é¦–å±€ä½“éªŒ | é¦–å±€èƒ½è·‘è¿‡ 3 ä¸ªä»¥ä¸Šéšœç¢ç‰©(ä¸å› éš¾åº¦è¿‡é«˜è€Œæ²®ä¸§) |
| U03 | è§†è§‰å¸å¼•åŠ› | è‰²å½©é²œæ˜ã€è§’è‰²å¯çˆ±ï¼Œèƒ½å¸å¼•å¹¼å„¿æ³¨æ„ |
| U04 | ç¢°æ’ä½“éªŒ | ç¢°æ’åæ— æŒ«è´¥æ„Ÿï¼Œè‡ªåŠ¨é‡å¼€æµç•…è‡ªç„¶ |
| U05 | æŒç»­æ¸¸ç© | èƒ½ä¿æŒ 5 åˆ†é’Ÿä»¥ä¸Šçš„æ¸¸ç©å…´è¶£ |

### 5.4 å…¼å®¹æ€§éªŒæ”¶

| ç¼–å· | éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† |
|-----|-------|---------|
| C01 | Chrome macOS | macOS Chrome æœ€æ–°ç¨³å®šç‰ˆæ­£å¸¸è¿è¡Œ |
| C02 | M3 Max | åœ¨ M3 Max MacBook Pro ä¸Šæ€§èƒ½è¾¾æ ‡ |
| C03 | å…¨å± | å…¨å±æ¨¡å¼ä¸‹å¸ƒå±€æ­£å¸¸ |

---

## å…­ã€é£é™©å’Œæ³¨æ„äº‹é¡¹

### 6.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| MediaPipe WASM åŠ è½½æ…¢ | é¦–æ¬¡å¯åŠ¨æ…¢ | ä½¿ç”¨ CDN + åŠ è½½è¿›åº¦æç¤º |
| å§¿æ€æ£€æµ‹ä¸ç¨³å®š | è¯¯è§¦å‘/æ¼è§¦å‘ | åŠ å¤§å»æŠ–ã€å¢åŠ ç½®ä¿¡åº¦è¿‡æ»¤ |
| Canvas æ¸²æŸ“å’Œæ£€æµ‹ç«äº‰ CPU | å¡é¡¿ | åŒå¸§ç‡åˆ†ç¦»ã€GPU delegate |
| å…‰çº¿ç¯å¢ƒå½±å“æ£€æµ‹ | æ£€æµ‹å¤±è´¥ | æç¤ºç”¨æˆ·æ”¹å–„å…‰çº¿ |
| éå®‰å…¨ä¸Šä¸‹æ–‡æ— æ³•å¯ç”¨æ‘„åƒå¤´ | åŠŸèƒ½ä¸å¯ç”¨ | å¼€å‘ä½¿ç”¨ `localhost`ï¼Œéƒ¨ç½²ä½¿ç”¨ HTTPSï¼Œå¹¶åœ¨å¼•å¯¼é¡µæå‰æç¤º |

### 6.2 å®‰å…¨æ³¨æ„äº‹é¡¹

- æ‘„åƒå¤´ç”»é¢**ä»…åœ¨æœ¬åœ°å¤„ç†**ï¼Œä¸ä¸Šä¼ ä»»ä½•æ•°æ®
- æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ‘„åƒå¤´ç”¨é€”
- å­©å­æ¸¸ç©æ—¶éœ€è¦æœ‰è¶³å¤Ÿçš„æ´»åŠ¨ç©ºé—´ï¼Œé¿å…ç¢°åˆ°å®¶å…·
- å»ºè®®æ¯æ¬¡æ¸¸ç©ä¸è¶…è¿‡ 15 åˆ†é’Ÿ

### 6.3 åç»­è¿­ä»£æ–¹å‘

1. **å¤šäººæ¨¡å¼**: æ£€æµ‹å¤šä¸ªèº«ä½“ï¼Œä¸¤ä¸ªå°æœ‹å‹åŒæ—¶ç©
2. **æ›´å¤šåŠ¨ä½œ**: æŒ¥æ‰‹æ‰“é£ç¿¼é¾™ã€è¸¢è…¿è¸¢å¼€ä»™äººæŒ
3. **ä¸»é¢˜æ¢è‚¤**: å¤œæ™šæ¨¡å¼ã€æµ·åº•æ¨¡å¼ã€å¤ªç©ºæ¨¡å¼
4. **éš¾åº¦é€‰æ‹©**: å®¶é•¿å¯æ‰‹åŠ¨è°ƒæ•´éš¾åº¦å‚æ•°
5. **æˆå°±ç³»ç»Ÿ**: æ”¶é›†æé¾™è›‹ã€è§£é”ä¸åŒé¢œè‰²çš„æé¾™
6. **å½•åƒå›æ”¾**: å½•åˆ¶æ¸¸æˆè¿‡ç¨‹(å«æ‘„åƒå¤´ç”»é¢)ï¼Œå®¶é•¿å¯åˆ†äº«
